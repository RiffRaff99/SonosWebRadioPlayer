<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Webradio</title>

        <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
        <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
    </head>
    <body class="container">
        <div class="row">
            <div id="info" class="span12"></div>
            <div class="hero-unit">
            <!-- <div class="span6"> -->
                <h1 id="track-title"></h1>
                <h2 id="track-artist"></h2>
                <h2 id="track-album"></h2>
                <button id="pause" class="btn"><i class="icon-pause"></i> Pause</button>
                <button id="volup" class="btn"><i class="icon-plus"></i> Volume</button>
                <button id="voldown" class="btn"><i class="icon-minus"></i> Volume</button>
            </div>
        </div>
        <div class="row">
            <div class="span12">
                <div class="row">
                        {% for key, value in stationList.items() %}
                        <div class="span2">
                            <!--<img data-src="holder.js/260x180" alt="260x180" style="width: 180px; height: 180px;" src="../static/img/{{ key }}.jpg"> -->
                            <div class="caption">
                                <h3>{{ key }}</h3>
                                <p><button class="btn" onclick="playThisUri('{{ key }}','{{ value }}')"><i class="icon-play"></i></button></p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>


        <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>

        <script type="text/javascript">
            var currTrack = '';


            function checkChange() {
                    loadData();
            }

            function playThisUri(stationName,uriToPlay) {
            $.ajax({type : 'POST',
                            url : 'http://127.0.0.1:5000/playuri',
                            data: '{"uri":"' + uriToPlay + '"}',
                            contentType: 'application/json;charset=UTF-8'
                     });


                     loadData();
            }

            function loadData() {
                $.getJSON('http://127.0.0.1:5000/info').done(function(data) {
                    var tmpTitle = data['title']
                    if (tmpTitle.length > 80 || tmpTitle.length < 1) {
                        tmpTitle = 'Radio Stream'
                    }
                    $('#track-title').text(tmpTitle);
                    $('#track-artist').text(data['artist']);
                    $('#track-album').text(data['album']);

                    currTrack = data['title'];
                });
            }

            $(document).ready(function() {
                loadData();
                setInterval("checkChange()", 1000);

                $('#volup').click(function() {
                    $.ajax('http://127.0.0.1:5000/volup');
                    loadData();
                });

                $('#pic').click(function() {
                    $.ajax({type : 'POST',
                            url : 'http://127.0.0.1:5000/playuri',
                            data: '{"uri":"x-rincon-mp3radio://streams.egofm.de/egoFM-hq"}',
                            contentType: 'application/json;charset=UTF-8'
                     });
                    loadData();
                });

                $('#voldown').click(function() {
                    $.ajax('http://127.0.0.1:5000/voldown');
                    loadData();
                });

                $('#next').click(function() {
                    $.ajax('http://127.0.0.1:5000/next');
                    loadData();
                });

                $('#previous').click(function() {
                    $.ajax('http://127.0.0.1:5000/previous');
                    loadData();
                });

                $('#pause').click(function() {
                    if (playing == true)
                    {
                        $.ajax('http://127.0.0.1:5000/pause');
                        playing = false;

                        $('#pause').html('<i class="icon-play"></i> Play');
                        $('#pause').html('<i class="icon-pause"></i> Pause');
                    }
                    else {
                        $.ajax('http://127.0.0.1:5000/playuri');
                        playing = true;

                        $('#pause').html('<i class="icon-pause"></i> Pause');
                    }
                });
            });
        </script>
   </body>
</html>
